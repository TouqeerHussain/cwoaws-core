<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>CWOAWS CORE by cloudwebops</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>CWOAWS CORE</h1>
        <h2>CWOAWS CORE Ansible playbook</h2>

        <section id="downloads">
          <a href="https://github.com/cloudwebops/cwoaws-core/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/cloudwebops/cwoaws-core/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/cloudwebops/cwoaws-core" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="cwoaws-core-ansible-playbook" class="anchor" href="#cwoaws-core-ansible-playbook" aria-hidden="true"><span class="octicon octicon-link"></span></a>CWOAWS CORE Ansible playbook</h1>

<p>Note:  This is a core playbook, please review, customize per you needs, and test it first before applying on production environments! Please report any issues through GitHub or email me at <a href="mailto:alex@cloudwebops.com">alex@cloudwebops.com</a> and I'll do my best to get back to you!</p>

<p>Recorded Terminal Session: <a href="http://cwoaws.s3-website.eu-central-1.amazonaws.com/session4.html">http://cwoaws.s3-website.eu-central-1.amazonaws.com/session4.html</a></p>

<p>CWOAWS CORE Ansible playbook have a purpose to setup operational AWS VPC infrastructure, all services on EC2 instances, RDS, etc, and to allow later execution of separated Playbooks for deployments, etc.</p>

<p>CWOAWS CORE Ansible Playbook Tasks:</p>

<ul>
<li> create 1 x VPC with 2 x VPC subnets in differrent AZ zones one AWS region</li>
<li> create 1 x security group</li>
<li> provision 2 x EC2 instances in 2 different AZ</li>
<li> Install webservers role on both instances (includes of other roles is possible, webservers role is required to allow instances registration to ELB)</li>
<li> launch and configure public facing VPC ELB (cross_az_load_balancing) and attach VPC subnets</li>
<li> deregister and register EC2 instances on ELB.</li>
<li> info about ELB dnsname is written in vars file and later can be used for DNS configuration</li>
</ul>

<p>All informations about VPC are defined in main.yml and vpc_info.yml(during playbook execution) files (AZ, regions, keypair, vpc, subnets, elb dns name info) 
.</p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Ansible and Boto installation Ubuntu 14.04 LTS</p>

<ul>
<li> $ sudo apt-get install software-properties-common</li>
<li> $ sudo apt-add-repository ppa:ansible/ansible</li>
<li> $ sudo apt-get update</li>
<li> $ sudo apt-get install ansible</li>
<li> $ apt-get install python-pip</li>
<li> $ pip install boto</li>
</ul>

<p>Download to folder /etc/ansible/</p>

<ul>
<li> $ wget <a href="https://raw.github.com/ansible/ansible/devel/plugins/inventory/ec2.py">https://raw.github.com/ansible/ansible/devel/plugins/inventory/ec2.py</a>
</li>
<li> $ wget <a href="https://raw.githubusercontent.com/ansible/ansible/devel/plugins/inventory/ec2.ini">https://raw.githubusercontent.com/ansible/ansible/devel/plugins/inventory/ec2.ini</a>
</li>
<li> $ chmod +x /etc/ansible/ec2.py</li>
</ul>

<p>In aws console create IAM user with PowerUser privileges
Add in file /home/ubuntu/.boto</p>

<ul>
<li>  [Credentials]</li>
<li>  aws_access_key_id = XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</li>
<li>  aws_secret_access_key = XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</li>
</ul>

<p>Add in clean file /home/ubuntu/.ansible.cfg</p>

<ul>
<li> [defaults]</li>
<li> host_key_checking = False</li>
<li>  private_key_file=/home/ubuntu/keypair.pem</li>
</ul>

<p>Run Playbook:</p>

<ul>
<li> $ansible-playbook -i hosts deploy-aws-infra.yml </li>
</ul>
      </section>
    </div>

    
  </body>
</html>
